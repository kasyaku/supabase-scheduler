name: Collect New Videos (18:20 JST)

on:
  schedule:
    - cron: '20 9 * * *'  # JST 18:20
  workflow_dispatch:       # 手動実行も可能にする

jobs:
  invoke-function:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Supabase CLI
        run: |
          curl -sL https://github.com/supabase/cli/releases/download/v2.65.5/supabase_2.65.5_linux_amd64.tar.gz | tar -xz
          sudo mv supabase /usr/local/bin/supabase

      - name: Invoke collect-new-videos function
        env:
          SUPABASE_ACCESS_TOKEN: ${{ secrets.SUPABASE_ACCESS_TOKEN }}
          SUPABASE_PROJECT_ID: ${{ secrets.SUPABASE_PROJECT_ID }}
          SUPABASE_FUNCTION_JWT_SECRET: ${{ secrets.SUPABASE_FUNCTION_JWT_SECRET }}
        run: |
          supabase functions invoke collect-new-videos \
            --project-ref $SUPABASE_PROJECT_ID \
            --no-verify-jwt
